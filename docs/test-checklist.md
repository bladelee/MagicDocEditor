# AFFiNE AI 编辑器 - 功能验收测试清单

## 📋 快速验收清单

### 环境检查

- [ ] AFFiNE 后端运行（SSH tunnel 10003端口）

  ```bash
  lsof -i:10003
  ```

- [ ] 前端开发服务器运行（3004端口）

  ```bash
  lsof -i:3004
  ```

- [ ] 浏览器开发者工具准备就绪（F12）

---

### 功能测试

#### 1. 本地模式基础功能 ✅

- [ ] 创建新文档
  - 步骤：访问 All Pages → 点击"+ 新建文档" → 输入标题 → 创建
  - 预期：文档出现在列表中，控制台显示创建成功

- [ ] 编辑文档（完整编辑器）
  - 步骤：点击"完整"按钮 → 添加内容 → 等待自动保存
  - 预期：内容保存成功，控制台显示自动保存

- [ ] 编辑文档（轻量级编辑器）
  - 步骤：点击"轻量"按钮 → 编辑内容
  - 预期：编辑器正常工作

- [ ] 删除文档
  - 步骤：点击"删除"按钮 → 确认删除
  - 预期：文档从列表中移除

#### 2. AFFiNE 认证配置 🔐

- [ ] 打开设置页面
  - URL: `http://localhost:3004/#/workspace/demo/settings`

- [ ] 获取 AFFiNE Token
  - 步骤：AFFiNE网站 → F12 → Application → Cookies → 复制 affine-session

- [ ] 保存 Token
  - 步骤：粘贴 Token → 点击"保存 Token"
  - 预期：显示"✅ 认证 token 已保存"
  - 预期：显示 Workspace 列表

- [ ] 复制 Workspace ID
  - 步骤：从设置页面"你的 Workspaces"部分复制第一个 ID

#### 3. AFFiNE 同步模式配置 ☁️

- [ ] 打开存储设置
  - 步骤：All Pages → 点击"⚙️ 设置"按钮

- [ ] 切换到 AFFiNE 模式
  - 步骤：点击"☁️ AFFiNE 同步模式"
  - 输入：Workspace ID（从步骤2复制）
  - 预期：Token 自动填充

- [ ] 检查 WebSocket 连接
  - 预期：控制台显示
  ```
  🔌 Connecting to AFFiNE WebSocket
  ✅ WebSocket connected
  ✅ Joined workspace
  ✅ Connected to AFFiNE WebSocket
  ```

#### 4. 文档同步到 AFFiNE 🔄

- [ ] 创建并同步文档
  - 步骤：创建新文档 → 输入内容 → 等待同步
  - 预期：控制台显示

  ```
  📤 Added to sync queue
  ✅ Document created in AFFiNE
  ✅ Sync completed
  ```

- [ ] 编辑并同步文档
  - 步骤：打开文档 → 添加内容 → 等待自动保存和同步
  - 预期：控制台显示

  ```
  💾 Document auto-saved
  ✅ Document updated in AFFiNE
  ```

- [ ] 验证 AFFiNE 后端
  - 步骤：打开 AFFiNE 官方界面 → 查找文档
  - 预期：文档和内容都存在

#### 5. 双向同步验证 ↔️

- [ ] 从 AFFiNE 接收更新
  - 步骤：在 AFFiNE 官方界面编辑 → 返回 AI 编辑器
  - 预期：本地自动更新，控制台显示接收更新

#### 6. 离线功能测试 📴

- [ ] 离线创建文档
  - 步骤：关闭网络/SSH tunnel → 创建文档
  - 预期：文档创建成功，保存到本地

- [ ] 离线编辑文档
  - 步骤：编辑文档内容
  - 预期：内容保存到本地

- [ ] 恢复网络后同步
  - 步骤：恢复网络/SSH tunnel → 等待自动同步
  - 预期：队列中的操作自动同步

#### 7. 错误处理 🛡️

- [ ] 无效 Token 处理
  - 测试：使用错误的 Token
  - 预期：显示错误，本地功能不受影响

- [ ] 网络中断处理
  - 测试：编辑时断网
  - 预期：操作保存在本地队列

#### 8. 性能检查 ⚡

- [ ] 大文档编辑
  - 测试：创建包含50+块的文档
  - 预期：编辑流畅，无卡顿

- [ ] 多文档并发编辑
  - 测试：快速编辑多个文档
  - 预期：所有文档正常同步

---

## 📊 验收标准

### 必须通过（P0）

- [x] 本地模式文档 CRUD 功能正常
- [x] AFFiNE Token 认证成功
- [x] WebSocket 连接成功
- [x] 文档可以同步到 AFFiNE
- [x] 编辑内容可以同步到 AFFiNE

### 应该通过（P1）

- [ ] 离线编辑功能正常
- [ ] 双向同步正常工作
- [ ] 错误处理和重试机制正常

### 期望通过（P2）

- [ ] 大文档性能良好
- [ ] 多文档并发同步正常
- [ ] 控制台无错误信息

---

## 🐛 常见问题快速修复

### WebSocket 连接失败

```bash
# 检查 SSH tunnel
lsof -i:10003

# 如果没有输出，重新建立
ssh -L 10003:localhost:3000 user@server
```

### Token 认证失败

```
1. 重新获取 Token（从 AFFiNE 网站）
2. 确保复制完整的值
3. 在设置页面重新保存
```

### 同步队列堆积

```javascript
// 在浏览器控制台执行
localStorage.removeItem('sync-queue');
location.reload();
```

### 清空所有数据

```javascript
// 在浏览器控制台执行
localStorage.clear();
indexedDB.deleteDatabase('ai-editor-local');
location.reload();
```

---

## 📝 测试结果记录

### 测试环境

- 测试日期：******\_\_\_\_******
- 测试人员：******\_\_\_\_******
- 浏览器版本：******\_\_\_\_******
- 操作系统：******\_\_\_\_******

### 测试结果

| 测试项            | 结果          | 备注 |
| ----------------- | ------------- | ---- |
| 本地创建文档      | ☐ 通过 ☐ 失败 |      |
| 本地编辑文档      | ☐ 通过 ☐ 失败 |      |
| AFFiNE 认证       | ☐ 通过 ☐ 失败 |      |
| WebSocket 连接    | ☐ 通过 ☐ 失败 |      |
| 文档同步到 AFFiNE | ☐ 通过 ☐ 失败 |      |
| 双向同步          | ☐ 通过 ☐ 失败 |      |
| 离线功能          | ☐ 通过 ☐ 失败 |      |
| 错误处理          | ☐ 通过 ☐ 失败 |      |

### 发现的问题

1. 问题描述：******\_\_\_\_******
   - 重现步骤：******\_\_\_\_******
   - 错误信息：******\_\_\_\_******
   - 截图：******\_\_\_\_******

2. 问题描述：******\_\_\_\_******
   - 重现步骤：******\_\_\_\_******
   - 错误信息：******\_\_\_\_******
   - 截图：******\_\_\_\_******

---

## ✅ 验收签字

### 开发团队确认

- 功能完整性：☐ 满足 ☐ 不满足
- 代码质量：☐ 良好 ☐ 需改进
- 性能表现：☐ 优秀 ☐ 需优化
- 签字：******\_\_\_\_****** 日期：******\_\_\_\_******

### 测试团队确认

- 功能测试：☐ 全部通过 ☐ 有问题
- 性能测试：☐ 达标 ☐ 未达标
- 兼容性：☐ 良好 ☐ 有问题
- 签字：******\_\_\_\_****** 日期：******\_\_\_\_******

### 产品负责人确认

- 需求满足：☐ 完全满足 ☐ 基本满足 ☐ 不满足
- 用户体验：☐ 优秀 ☐ 良好 ☐ 需改进
- 上线就绪：☐ 是 ☐ 否
- 签字：******\_\_\_\_****** 日期：******\_\_\_\_******
