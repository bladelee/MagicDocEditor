## 核心定位

本需求聚焦 **Web端SaaS模式AI文档编辑器核心功能**，核心能力为「手动编辑文档 + AI Chat生成/局部修改文档 + 文档管理 + 性能兼容 + 数据安全」，基于AFFiNE核心代码提取改造，支持嵌入其他应用，适配设计、开发、测试、验收全流程落地。

## 角色定义

1. 普通用户（免费/付费）：核心使用者，手动编辑文档、调用AI功能、管理个人文档/工作区；

2. 开发/测试人员：基于需求验证功能可用性、性能、兼容性，确保核心功能可顺利嵌入其他应用；

3. 系统管理员：辅助管理核心功能相关配置，保障嵌入后功能稳定运行。

## 一、文档基础编辑模块

### US-001：手动创建并编辑文档

- 角色：普通用户

- 用户故事：作为普通用户，我希望能创建空白文档并手动编辑内容，支持基础格式调整，确保内容可灵活修改且自动同步云端，避免本地丢失，嵌入其他应用后仍可正常使用。

- 验收准则：

- 点击「新建文档」可生成空白文档，默认标题为“Untitled Document”，自动归属当前工作区；嵌入场景下可关联宿主应用用户身份，归属对应关联空间；

- 支持文本输入/删除/修改，光标位置实时响应，无卡顿（编辑延迟≤100ms），嵌入后性能无明显下降；

- 支持基础格式调整：标题（H1-H6）、粗体/斜体/下划线、有序/无序列表、代码块插入；

- 编辑内容5秒内自动同步至云端PostgreSQL数据库，刷新页面或切换宿主应用页面后内容不丢失；

- 支持手动触发“保存”按钮，保存状态实时提示（成功/失败）；

- 文档内容支持“撤销/重做”（至少保留50步操作记录），嵌入场景下操作连贯性不受影响。

### US-002：文档格式预览与排版优化

- 角色：普通用户

- 用户故事：作为普通用户，我希望能预览文档最终效果，调整内容排版，确保文档格式规范、可读性强，嵌入其他应用后排版样式保持一致。

- 验收准则：

- 提供「预览模式」切换，预览时隐藏编辑工具栏，仅展示最终排版效果；嵌入场景下预览模式适配宿主应用界面风格；

- 支持段落间距调整、文本对齐（左对齐/居中/右对齐）；

- 格式调整后实时生效，预览模式下内容不可编辑，可切换回编辑模式；

- 代码块支持语法高亮（至少覆盖TS/JS/HTML/CSS/Markdown），嵌入后高亮样式与宿主应用无冲突。

## 二、AI功能模块

### US-003：AI Chat生成完整文档

- 角色：普通用户

- 用户故事：作为普通用户，我希望通过AI Chat输入指令，生成完整文档内容，支持流式展示，提升文档创作效率，嵌入其他应用后AI功能调用无阻碍。

- 验收准则：

- 编辑器侧边栏提供「AI Chat面板」，支持输入自然语言指令（如“写一篇AI文档编辑器的产品介绍，1000字”）；嵌入场景下面板可适配宿主应用布局，支持最小化/隐藏；

- 点击「生成」后，AI响应首字符时间≤3秒，支持流式实时输出内容，逐段渲染至文档，嵌入后流式传输无延迟；

- 生成过程中支持「取消生成」，已输出内容保留在文档中；

- 生成内容自动继承文档基础格式（如标题层级、段落间距），可后续手动调整；

- 支持选择AI模型（OpenAI GPT-3.5/4o、Gemini Pro），默认使用GPT-3.5；嵌入场景下可通过接口配置默认模型；

- 生成记录计入AI使用配额，消耗Token数实时统计（1 Token≈4字符，误差≤10%），嵌入后配额关联宿主应用用户账号。

### US-004：AI Chat局部修改文档内容

- 角色：普通用户

- 用户故事：作为普通用户，我希望选中文档局部内容后，通过AI Chat发送修改指令（改写/总结/翻译），精准优化内容，无需全文重写，嵌入场景下局部修改功能正常适配。

- 验收准则：

- 支持选中任意文本段落，右键或工具栏触发「AI修改」，关联Chat面板并自动填充选中内容；嵌入场景下右键菜单与宿主应用菜单无冲突；

- 支持常见修改指令：改写（调整语气/风格）、总结（精简为要点）、翻译（中/英互译）、纠错（语法/逻辑）；

- AI返回修改结果后，提供「替换选中内容」「插入到选中位置后」「取消」三个选项；

- 局部修改过程支持流式输出，修改后的内容格式与原文保持一致；

- 多次局部修改可在Chat面板保留对话上下文，支持基于历史指令继续优化，嵌入后上下文不丢失。

### US-005：Prompt模板生成文档

- 角色：普通用户

- 用户故事：作为普通用户，我希望使用预设Prompt模板生成文档，无需手动输入复杂指令，适配不同场景（如报告/邮件/文案），嵌入场景下模板可按需加载。

- 验收准则：

- AI Chat面板提供「模板库」入口，展示分类模板（如工作汇报、营销文案、技术文档）；嵌入场景下可通过接口筛选模板，隐藏不必要分类；

- 选择模板后，提示输入关键参数（如汇报周期、核心主题、目标受众），参数校验非空必填项；

- 填充参数后生成文档，内容贴合模板逻辑与参数要求，格式规范；

- 支持收藏常用模板，收藏后展示在模板库顶部；

- 模板内容基于MD格式存储，支持管理员更新维护，嵌入场景下可加载宿主应用自定义模板。

## 三、文档管理模块

### US-006：文档创建/重命名/删除/移动

- 角色：普通用户

- 用户故事：作为普通用户，我希望能管理个人文档，包括重命名、删除、移动至不同工作区，确保文档归类清晰，嵌入其他应用后文档管理操作与独立使用一致。

- 验收准则：

- 文档标题支持双击修改，重命名后实时同步至云端，长度限制1-100字符；嵌入场景下标题修改可同步至宿主应用关联记录；

- 支持单个/批量删除文档，删除前弹出确认提示，删除后移入“回收站”（保留7天可恢复）；

- 支持创建多个工作区，文档可跨工作区移动，移动后归属关系更新，权限同步；嵌入场景下可关联宿主应用的空间/项目结构；

- 文档列表展示标题、创建时间、最后修改时间，支持按“修改时间”升序/降序排序；

- 支持搜索文档（按标题关键词），搜索结果实时展示，匹配度降序排列，嵌入场景下搜索功能可与宿主应用搜索集成。

### US-007：文档版本回溯

- 角色：普通用户

- 用户故事：作为普通用户，我希望能查看文档历史版本，回溯至指定版本，避免误编辑导致内容丢失，嵌入场景下版本管理功能正常可用。

- 验收准则：

- 系统自动记录文档版本（每30分钟或内容变更≥10字符触发版本创建），版本记录包含时间、操作人、变更摘要；

- 文档详情页提供「版本历史」入口，展示所有版本列表，支持预览各版本内容；

- 支持“回溯至该版本”，回溯后生成新版本，原版本保留不删除；

- 版本历史至少保留30天，付费用户可延长至90天。

## 四、性能与兼容性模块（嵌入适配核心）

### US-014：系统性能要求

- 角色：开发/测试人员

- 用户故事：作为测试人员，我希望系统性能达标，在多场景下无卡顿、无崩溃，嵌入其他应用后不影响宿主应用性能，保障用户体验。

- 验收准则：

- 页面加载时间≤2秒（首次加载）、≤1秒（二次加载，依赖缓存）；嵌入场景下加载时间≤3秒，不阻塞宿主应用渲染；

- 文档编辑（单文档≤5000字符）无卡顿，格式调整实时响应；

- AI流式输出无断连，单段内容生成完成时间≤10秒（1000字内）；

- 支持同时在线用户≥100人，单工作区并发编辑≤10人，无数据冲突；嵌入场景下并发能力可按需扩展；

- 数据库查询响应时间≤300ms，AI接口请求响应时间（非流式）≤5秒，嵌入后接口调用延迟无明显增加。

### US-015：浏览器兼容性

- 角色：开发/测试人员

- 用户故事：作为开发人员，我希望系统兼容主流浏览器，确保不同用户均可正常使用，嵌入其他应用后适配宿主应用支持的浏览器范围。

- 验收准则：

- 兼容浏览器：Chrome（≥100）、Edge（≥100）、Firefox（≥98）、Safari（≥15）；

- 不同浏览器下，功能、样式一致性达标，无布局错乱、功能失效问题；嵌入场景下与宿主应用样式无冲突；

- 移动Web端（手机/平板）支持基础编辑与AI功能，适配屏幕尺寸，操作便捷，嵌入移动应用H5页面时体验一致。

## 五、数据安全与合规模块

### US-016：数据安全与备份

- 角色：管理员/开发人员

- 用户故事：作为管理员，我希望用户数据安全有保障，定期备份，避免数据丢失或泄露，嵌入其他应用后数据隔离与安全合规性不受影响。

- 验收准则：

- 所有用户数据（文档、账号、AI记录）存储在PostgreSQL数据库，每日自动备份（增量备份+每日全量备份）；嵌入场景下数据与宿主应用数据隔离存储；

- 备份数据保留30天，支持故障时快速恢复，数据丢失率为0；

- 文档内容传输采用HTTPS加密，本地缓存数据（如Cookie）加密存储，无敏感信息明文暴露；

- 支持用户主动导出个人文档（ZIP格式，含所有版本），导出后数据不残留平台；

- 用户注销账号后，数据保留7天可恢复，7天后永久删除，不可恢复；嵌入场景下用户注销后关联文档同步处理。

## 验收标准总纲

1. 功能验收：所有用户故事的验收准则100%通过，无核心功能缺失，嵌入其他应用后功能完整性不受影响；

2. 性能验收：满足US-014所有性能指标，压力测试下无崩溃、无数据异常，嵌入后不拖慢宿主应用性能；

3. 兼容性验收：覆盖US-015所有浏览器，功能与样式一致，适配不同嵌入场景布局；

4. 安全验收：通过密码加密、传输加密、数据备份验证，无安全漏洞，嵌入场景下数据隔离合规；

5. 易用性验收：操作流程简洁，核心功能（创建文档、AI生成、修改）操作步骤≤3步，嵌入后操作逻辑与宿主应用衔接流畅。
   > （注：文档部分内容可能由 AI 生成）
