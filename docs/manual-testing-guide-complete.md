# 前端功能完整手工测试操作说明

**日期**: 2025-01-16
**测试范围**: 5大功能模块
**测试环境**: http://localhost:5173 (前端) + http://localhost:3010 (AFFiNE 后端)

---

## 📋 测试前准备

### 1. 环境检查

```bash
# 确保前端开发服务器运行中
cd /home/ubuntu/proj/AFFiNE/src/web
npm run dev
# 应该看到: Local: http://localhost:5173

# 确保 AFFiNE 后端运行中
docker ps | grep affine
# 应该看到 affine-postgres, affine-affine 容器
```

### 2. 获取认证 Cookie（如需要）

```bash
# 打开浏览器访问 http://localhost:3010
# 登录 AFFiNE
# 打开开发者工具 (F12) → Application → Cookies
# 复制 Cookie 值
export AFFINE_COOKIE="better-auth.session_token=...; affine_session=..."
```

### 3. 访问应用

在浏览器打开: `http://localhost:5173`

---

## 🧪 功能模块测试

### 模块 1: AI Chat Phase 1 ✅

**功能概述**: AI 对话面板，支持快捷操作、消息历史、插入文档

#### 测试步骤

**1.1 访问编辑器页面**

```
URL: http://localhost:5173/#/workspace/demo/page1
```

**1.2 检查 AI Chat 面板**

- [ ] 右侧显示 AI 助手面板
- [ ] 顶部显示 "新对话" 按钮
- [ ] 显示 4 个快捷操作按钮:
  - 📝 总结
  - ✨ 改进
  - 📖 扩展
  - 🌐 翻译

**1.3 测试快捷操作**

- [ ] 点击 "📝 总结" 按钮
- [ ] AI 开始显示 "正在思考..." 动画
- [ ] AI 返回总结响应
- [ ] 响应下方显示操作按钮:
  - "+ 插入到文档"
  - "🔄 替换选中内容"

**1.4 测试手动输入**

- [ ] 在输入框输入: "请帮我写一段关于人工智能的介绍"
- [ ] 按 `Cmd+Enter` 或点击 "发送" 按钮
- [ ] 消息出现在对话列表
- [ ] AI 返回响应

**1.5 测试插入功能**

- [ ] 点击 AI 响应下方的 "+ 插入到文档" 按钮
- [ ] 检查是否触发 `ai-insert-content` 事件（在控制台查看）

**1.6 测试新对话**

- [ ] 点击 "新对话" 按钮
- [ ] 对话历史被清空

#### 预期结果

| 测试项   | 预期行为                              |
| -------- | ------------------------------------- |
| 快捷操作 | 点击按钮自动发送预设 prompt           |
| AI 响应  | 显示格式化的响应内容                  |
| 操作按钮 | 每条 AI 响应下方显示插入和替换按钮    |
| 消息历史 | 用户消息显示为紫色，AI 消息显示为灰色 |
| 加载状态 | AI 思考时显示动画效果                 |

#### 已知限制

- Mock 模式下返回模拟响应
- 需要配置后端才能使用真实 AI

---

### 模块 2: Document Editing ✅

**功能概述**: 文档编辑器，支持自动保存、块编辑

#### 测试步骤

**2.1 访问编辑器页面**

```
URL: http://localhost:5173/#/workspace/demo/page1
```

**2.2 检查编辑器**

- [ ] 中间显示文档编辑器区域
- [ ] 显示文档标题
- [ ] 可以点击并编辑内容

**2.3 测试块编辑**

- [ ] 在编辑器中输入文本
- [ ] 等待 1 秒（自动保存延迟）
- [ ] 检查控制台是否显示 "Document saved" 消息

**2.4 测试本地存储**

- [ ] 输入一些文本
- [ ] 刷新页面
- [ ] 内容应该保留（localStorage 持久化）

#### 预期结果

| 测试项   | 预期行为                |
| -------- | ----------------------- |
| 自动保存 | 编辑停止 1 秒后自动保存 |
| 本地存储 | 数据保存到 localStorage |
| 后端同步 | 尝试同步到 AFFiNE 后端  |

#### 已知限制

- 需要配置后端才能同步到云端
- 没有冲突检测

---

### 模块 3: Document Management Phase 1 + Search ✅

**功能概述**: 文档列表、搜索、创建、删除

#### 测试步骤

**3.1 访问文档列表页面**

```
URL: http://localhost:5173/#/workspace/demo/all
```

**3.2 检查文档列表**

- [ ] 显示 "所有文档" 标题
- [ ] 显示 Workspace ID
- [ ] 显示文档数量统计
- [ ] 显示搜索框、新建文档按钮、刷新按钮

**3.3 测试搜索功能**

- [ ] 在搜索框输入关键词
- [ ] 等待 300ms（防抖延迟）
- [ ] 文档列表根据搜索结果过滤
- [ ] 清空搜索框恢复完整列表

**3.4 测试创建文档**

- [ ] 点击 "+ 新建文档" 按钮
- [ ] 弹出创建对话框
- [ ] 输入文档标题: "测试文档"
- [ ] 点击 "创建" 按钮或按 Enter 键
- [ ] 自动导航到新文档编辑器页面

**3.5 测试删除文档**

- [ ] 在文档列表中找到某个文档
- [ ] 点击该文档卡片上的 "删除" 按钮
- [ ] 确认删除对话框弹出
- [ ] 点击 "确定" 删除文档
- [ ] 文档从列表中移除

**3.6 测试打开文档**

- [ ] 点击文档卡片
- [ ] 或点击 "打开" 按钮
- [ ] 导航到编辑器页面

#### 预期结果

| 测试项   | 预期行为                   |
| -------- | -------------------------- |
| 文档列表 | 以卡片网格形式显示所有文档 |
| 搜索功能 | 实时过滤文档标题和内容     |
| 创建文档 | 创建新文档并导航到编辑器   |
| 删除文档 | 删除后从列表移除           |
| 空状态   | 无文档时显示提示信息       |

#### 已知限制

- Mock 模式下文档仅存在于内存
- 需要配置后端才能持久化

---

### 模块 4: Prompt Templates Phase 1 ✅

**功能概述**: Prompt 模板库，浏览和使用 AI 模板

#### 测试步骤

**4.1 访问 Prompt Templates 页面**

```
URL: http://localhost:5173/#/workspace/demo/prompts
```

**4.2 检查模板库**

- [ ] 显示 "AI Prompt 模板库" 标题
- [ ] 显示搜索框、刷新按钮
- [ ] 显示模板卡片网格

**4.3 测试模板加载**

- [ ] 页面加载时自动获取模板列表
- [ ] 每个模板卡片显示:
  - 模板名称
  - 模板描述（如果有）
  - 类型标签（chat/generate/edit）
  - 模型标签（如果有）
  - "使用模板" 按钮

**4.4 测试搜索功能**

- [ ] 在搜索框输入关键词
- [ ] 模板列表根据名称和描述过滤

**4.5 测试模板选择**

- [ ] 点击模板卡片
- [ ] 底部显示 "已选择: [模板名称]"
- [ ] 显示模板详情面板

**4.6 测试使用模板**

- [ ] 点击模板的 "使用模板" 按钮
- [ ] 或点击模板后在详情面板点击 "使用此模板"
- [ ] 自动导航到新编辑器页面，使用该模板

#### 预期结果

| 测试项   | 预期行为                      |
| -------- | ----------------------------- |
| 模板列表 | 显示所有可用的 AI Prompt 模板 |
| 搜索功能 | 根据名称和描述过滤模板        |
| 模板选择 | 高亮选中模板，显示详情        |
| 使用模板 | 创建新文档并应用模板          |
| 空状态   | 无模板时显示提示信息          |

#### 已知限制

- Mock 模式下返回预设的模板数据
- 需要配置后端才能获取真实模板

---

### 模块 5: Database View Phase 1 ✅

**功能概述**: 数据库表格视图，行/列管理

#### 测试步骤

**5.1 访问 Database View 页面**

```
URL: http://localhost:5173/#/workspace/demo/database/demo-db
```

**5.2 检查表格视图**

- [ ] 显示 "数据库视图" 标题
- [ ] 显示 Workspace 和 Document ID
- [ ] 显示表格区域
- [ ] 显示 "+ 添加行" 按钮
- [ ] 底部显示统计信息

**5.3 测试表格结构**

- [ ] 显示默认列:
  - 名称 (TEXT)
  - 状态 (SELECT)
  - 日期 (DATE)

**5.4 测试添加行**

- [ ] 点击 "+ 添加行" 按钮
- [ ] 新行出现在表格中
- [ ] 新行所有单元格为空

**5.5 测试单元格编辑**

**TEXT 类型:**

- [ ] 点击单元格
- [ ] 变成输入框
- [ ] 输入文本
- [ ] 按 Enter 或点击外部保存

**NUMBER 类型:**

- [ ] 点击数字单元格
- [ ] 变成数字输入框
- [ ] 输入数字
- [ ] 保存

**DATE 类型:**

- [ ] 点击日期单元格
- [ ] 显示日期选择器
- [ ] 选择日期
- [ ] 自动保存

**SELECT 类型:**

- [ ] 点击下拉单元格
- [ ] 显示下拉选项:
  - 请选择...
  - 待办
  - 进行中
  - 已完成
- [ ] 选择选项

**CHECKBOX 类型:**

- [ ] 点击复选框
- [ ] 切换选中状态

**5.6 测试删除行**

- [ ] 点击行右侧的 "删除" 按钮
- [ ] 确认删除对话框弹出
- [ ] 确定后行被移除

**5.7 测试行点击**

- [ ] 点击整行
- [ ] 触发 `onRowClick` 回调
- [ ] 控制台显示日志

#### 预期结果

| 测试项     | 预期行为                 |
| ---------- | ------------------------ |
| 表格展示   | 显示列头和数据行         |
| 添加行     | 创建新的空行             |
| 单元格编辑 | 根据类型显示不同的编辑器 |
| 删除行     | 删除后从表格移除         |
| 空状态     | 无数据时显示提示信息     |
| 固定表头   | 滚动时表头固定在顶部     |

#### 已知限制

- Mock 模式下数据仅存在于内存
- 需要验证 AFFiNE 的表格块 API

---

## 🔧 高级测试场景

### 场景 1: 完整工作流测试

**目标**: 测试从创建文档到使用 AI 编辑的完整流程

**步骤**:

1. 访问文档列表页面 (`/workspace/demo/all`)
2. 点击 "+ 新建文档"
3. 输入标题 "AI 测试文档"
4. 点击 "创建"
5. 在编辑器中输入: "这是一段测试文本"
6. 等待自动保存
7. 点击右侧 AI 面板的 "📝 总结" 按钮
8. 等待 AI 生成总结
9. 点击 "+ 插入到文档"
10. 检查内容是否插入

**预期结果**: 全流程无错误，数据正常保存

### 场景 2: 模板驱动的 AI 对话

**目标**: 测试使用 Prompt 模板启动 AI 对话

**步骤**:

1. 访问 Prompt Templates 页面 (`/workspace/demo/prompts`)
2. 浏览可用模板
3. 点击 "Chat With AFFiNE AI" 模板
4. 查看模板详情
5. 点击 "使用此模板"
6. 自动打开新编辑器页面
7. AI 面板已初始化并准备好对话

**预期结果**: 模板正确应用，AI 会话已准备

### 场景 3: 数据库视图操作

**目标**: 测试数据库表格的增删改操作

**步骤**:

1. 访问 Database View 页面 (`/workspace/demo/database/demo-db`)
2. 点击 "+ 添加行" 3 次
3. 在第一行的 "名称" 列输入: "任务 1"
4. 在第一行的 "状态" 列选择: "进行中"
5. 在第一行的 "日期" 列选择: 2025-01-16
6. 点击第二行删除按钮
7. 修改第三行的数据
8. 刷新页面检查数据是否持久化

**预期结果**: 所有操作正常执行，数据正确显示

---

## 📊 测试记录表

### 测试执行记录

| 模块                | 测试项       | 通过 | 失败 | 备注 |
| ------------------- | ------------ | ---- | ---- | ---- |
| AI Chat             | 快捷操作按钮 | ⬜   |      |      |
| AI Chat             | 手动输入消息 | ⬜   |      |      |
| AI Chat             | 插入到文档   | ⬜   |      |      |
| AI Chat             | 新对话功能   | ⬜   |      |      |
| Document Editing    | 自动保存     | ⬜   |      |      |
| Document Editing    | 本地持久化   | ⬜   |      |      |
| Document Management | 文档列表     | ⬜   |      |      |
| Document Management | 搜索功能     | ⬜   |      |      |
| Document Management | 创建文档     | ⬜   |      |      |
| Document Management | 删除文档     | ⬜   |      |      |
| Prompt Templates    | 模板列表     | ⬜   |      |      |
| Prompt Templates    | 搜索模板     | ⬜   |      |      |
| Prompt Templates    | 使用模板     | ⬜   |      |      |
| Database View       | 表格展示     | ⬜   |      |      |
| Database View       | 添加行       | ⬜   |      |      |
| Database View       | 编辑单元格   | ⬜   |      |      |
| Database View       | 删除行       | ⬜   |      |      |

---

## ⚠️ 常见问题排查

### 问题 1: 页面显示 404

**可能原因**:

- 路由配置错误
- URL 路径错误

**解决方法**:

```bash
# 检查路由配置
cat src/web/routes/index.ts

# 确认 URL 格式正确
# 正确: /workspace/:workspaceId/all
# 错误: /workspace/:workspaceId/pages
```

### 问题 2: 组件不显示

**可能原因**:

- 组件导入失败
- 数据加载失败

**解决方法**:

```bash
# 检查浏览器控制台
# 查看是否有 JavaScript 错误

# 检查网络请求
# 打开 Network 标签查看 API 请求
```

### 问题 3: API 请求失败

**可能原因**:

- 后端服务未启动
- CORS 配置问题
- 认证失败

**解决方法**:

```bash
# 检查后端服务
docker ps | grep affine

# 检查 CORS 配置
# 后端需要允许 http://localhost:5173

# 检查认证 Cookie
# 打开 Application → Cookies 查看是否有有效 Cookie
```

### 问题 4: Mock 模式返回模拟数据

**说明**:

- 这是正常行为
- Mock 模式用于前端开发和测试
- 配置后端后切换到真实 API

**切换到真实 API**:

```bash
# 设置环境变量
export VITE_GRAPHQL_URL=http://localhost:3010/graphql
export VITE_USE_MOCK_API=false

# 重启前端服务
cd src/web
npm run dev
```

---

## 📝 测试报告模板

完成测试后，请填写以下信息：

```markdown
## 测试报告

**测试日期**: [填写日期]
**测试者**: [填写姓名]
**测试环境**:

- 前端: http://localhost:5173
- 后端: http://localhost:3010
- 浏览器: [填写浏览器版本]

### 测试结果

| 模块                | 通过 | 失败 | 阻塞 | 备注 |
| ------------------- | ---- | ---- | ---- | ---- |
| AI Chat             | [ ]  | [ ]  | [ ]  |      |
| Document Editing    | [ ]  | [ ]  | [ ]  |      |
| Document Management | [ ]  | [ ]  | [ ]  |      |
| Prompt Templates    | [ ]  | [ ]  | [ ]  |      |
| Database View       | [ ]  | [ ]  | [ ]  |      |

### 发现的问题

1. [问题描述]
   - 重现步骤:
   - 预期行为:
   - 实际行为:
   - 截图/日志:

### 建议

[填写改进建议]

### 总体评价

[填写总体评价和评分]
```

---

## 🚀 测试完成后

1. **提交测试报告**
   - 将测试结果反馈给开发团队
   - 附上问题截图和日志

2. **更新文档**
   - 标记已通过的测试项
   - 记录发现的问题

3. **跟进问题**
   - 创建 GitHub Issue 跟踪问题
   - 分配给相关开发人员

---

**文档版本**: 1.0
**最后更新**: 2025-01-16
**维护者**: Claude Code
